# Emotion Timeline Player PRD (Kotlin Ver.)

## 1. 프로젝트 개요

**한 줄 요약:** 온디바이스 감정 분석으로 웃는 장면을 자동 추출하고 하이라이트로 감상할 수 있는 '하이퍼랩스 감정 하이라이트 플레이어' 앱

**핵심 가치:**  
이 앱은 TFLite 기반 온디바이스 감정 분석을 활용하여, 긴 하이퍼랩스 영상 속에서 웃는 순간을 자동으로 찾아 하이라이트 클립으로 보여줍니다. 사용자는 긴 영상을 전체 감상하지 않아도 재미있는 구간만 빠르게 확인할 수 있으며, ExoPlayer 기반 디스크 캐싱 최적화를 통해 끊김 없는 시청 경험을 제공합니다. 모든 분석은 온디바이스에서 이루어져 개인정보 보호도 강화됩니다.


## 2. 유저 플로우

1. **폴더 (메인 페이지):**
   - 향후 확장성을 고려한 폴더 구조 가능성 고려 (MVP에서는 단일 피드 시작 가능)

2. **영상 피드 화면:**
   - 서버 없이 로컬 샘플 영상 몇 개로 시작
   - 전체 영상 세로 스크롤
   - 각 아이템: 썸네일 + 제목 (혹은 촬영 일자 표시)
   - 현재 화면에 보이는 영상만 자동 재생 (ExoPlayer View)
   - 다음 영상 프리로딩 (캐시 관리 연결)
   - Jetpack Compose `LazyColumn` 사용

3. **영상 상세 화면 (Video Player 화면):**
   - 선택된 영상 전체 재생 화면
   - 상단: 영상 플레이어 (ExoPlayer)
   - 하단: 웃음 이모지 마커가 찍힌 ProgressBar (TimeBar 커스터마이징)
   - LOL 버튼: 웃음 하이라이트만 재생 기능
   - 감정 분석 완료 후 마커 등장 UI 포함

4. **(초기) 영상 소스 가져오기 화면 (로컬 파일 불러오기):**
   - 기기에 저장된 영상 선택 (파일 시스템 or MediaStore 접근)
   - MVP에서는 로컬 샘플 영상으로 충분히 시작 가능


## 3. 핵심 기능

### 감정 분석 및 하이라이트 추출

- 얼굴 검출 (Google ML Kit 활용)
- 감정 분류 (TFLite 웃음 감정 분류)
- 웃음 프레임 수집 및 연속 구간 병합 (0.5~1초 기준)
- 하이라이트 리스트 생성 (타임스탬프 구간)
- 이모지 마커 표시 (😂)
- LOL 버튼 클릭 시 하이라이트만 이어붙여 재생 (ConcatenatingMediaSource)

### 영상 피드 및 캐싱 최적화

- ExoPlayer SimpleCache 기반 디스크 캐싱 (200MB 제한)
- LRU 정책 기반 캐시 관리
- 다음 영상 프리로딩으로 재생 시작 지연 최소화
- 메모리 효율 중심: 디스크 캐시 위주 설계

### 메모리 최적화 세부사항

- 프레임 샘플링 (초당 1~3프레임만 추출)
- Bitmap inSampleSize 적용, 추론 후 즉시 recyc
